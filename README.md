# XFY 加载页文档

## 简介

XFY 加载页是一个通用的单页应用加载页面，专为 React 和 Vue 应用设计，提供平滑的页面过渡效果和加载动画。

## 功能特点

- **自动路径跳转**：访问根目录时自动跳转到 `/home` 路径（有自定义需求请看第1263行）
- **框架检测**：自动检测目标页面是 React 应用（挂载点 `id="root"`）还是 Vue 应用（挂载点 `id="app"`）
- **平滑过渡**：实现页面间的平滑淡入淡出效果
- **加载动画**：显示美观的 3D 立方体加载动画
- **资源管理**：自动清理之前加载的脚本和样式，避免冲突
- **应用内部导航**：已加载的应用内部导航交由应用自身处理，不触发加载动画
- **标题和图标更新**：只替换目标页面的标题、favicon 和 apple-touch-icon，保持加载页的其他设置

## 实现原理

1. **HTML 结构**：包含加载动画容器、React 挂载点、Vue 挂载点和黑色背景层
2. **CSS 样式**：定义加载动画、容器布局和过渡效果
3. **JavaScript 逻辑**：
   - 监听地址变更和链接点击
   - 检测目标页面的框架类型
   - 加载目标页面的资源
   - 实现平滑的页面过渡效果
   - 管理应用内部导航

## 使用方法

1. **部署加载页**：将 `index.html` 部署到网站根目录
2. **配置应用路径**：确保 React 应用部署在挂载点 `id="root"` 的页面，Vue 应用部署在挂载点 `id="app"` 的页面
3. **访问应用**：通过加载页访问应用，体验平滑的加载和过渡效果

## 代码结构

### 主要函数

1. **init()**：初始化加载页，设置事件监听器
2. **handleUrlChange(url, isButtonClick)**：处理地址变更，执行加载流程
3. **loadHtmlResource(url)**：加载 HTML 资源，提取标题、图标和脚本
4. **fadeOutMountPoints()**：淡出所有挂载点，准备加载新应用
5. **fadeInApp(framework)**：淡入对应框架的挂载点，显示新应用
6. **cleanupLoadedResources()**：清理之前加载的脚本和样式
7. **checkFrameworkType(htmlContent)**：检查 HTML 内容是否为 React 或 Vue 应用

### 核心流程

1. **地址变更检测**：监听浏览器地址变更和链接点击
2. **资源加载**：加载目标页面的 HTML 资源
3. **框架检测**：检测目标页面是 React 还是 Vue 应用
4. **资源清理**：清理之前加载的脚本和样式
5. **页面过渡**：淡出当前应用，显示加载动画，并在确保js和css资源完全加载后，再淡入新应用
6. **应用内部导航**：已加载的应用内部导航交由应用自身处理

## 注意事项

1. **挂载点要求**：React 应用必须使用 `id="root"` 作为挂载点，Vue 应用必须使用 `id="app"` 作为挂载点（默认情况下均为这么配置的）
2. **资源路径**：确保应用的脚本和样式路径正确，支持相对路径和绝对路径
3. **跨域资源**：如果应用加载跨域资源，确保目标服务器支持 CORS
4. **性能优化**：对于大型应用，建议优化资源加载速度，减少加载时间
5. **兼容性**：支持现代浏览器，对于旧浏览器可能需要额外的 polyfill

## 示例

### 访问根目录

当访问 `https://example.com/` 时，加载页会自动跳转到 `https://example.com/home`，并显示加载动画。

### 切换应用

当从 React 应用切换到 Vue 应用时，加载页会：
1. 淡出当前 React 应用
2. 显示加载动画
3. 加载 Vue 应用的资源
4. 淡入 Vue 应用

### 应用内部导航

在已加载的应用内部导航时，加载页不会显示，导航交由应用自身处理，提供流畅的用户体验。

## 定制化

### 修改加载动画

可以通过修改 `.loader` 相关的 CSS 样式来定制加载动画的外观。

### 修改加载提示

可以修改加载提示文字的内容、样式和位置，以适应不同的应用场景。

### 修改自动跳转路径

可以修改 `init()` 函数中的跳转逻辑，将根目录跳转到其他路径。

## 总结

XFY 加载页为单页应用提供了美观、平滑的加载和过渡效果，提升了用户体验。通过自动检测框架类型、管理资源和应用内部导航，加载页能够智能地处理不同类型的页面跳转，为用户提供一致的浏览体验。
